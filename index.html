<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <script src="https://cdn.marmot-cloud.com/npm/hylid-bridge/2.10.0/index.js"></script>
    </head>
    <body>
        <button onclick="authenticate()">Login</button>

        <script>
            var authcode = "";
            function authenticate() {
                my.getAuthCode({
                    scopes: ["auth_base", "USER_ID"],
                    success: (res) => {
                        authcode = res.authCode;
                        document.getElementById("authcode").textContent =
                            authcode;
                        fetch(
                            "https://its.mouamle.space/api/auth-with-superQian",
                            {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                },
                                body: JSON.stringify({ token: authcode }),
                            }
                        )
                            .then((res) => res.json())
                            .then((data) => {
                                my.alert({
                                    content: "Login successful! Welcome ",
                                });
                            })
                            .catch((err) => {
                                let errorDetails = "";
                                if (err && typeof err === "object") {
                                    errorDetails = JSON.stringify(err, null, 2);
                                } else {
                                    errorDetails = String(err);
                                }
                            });
                        my.alert({
                            content: res.authCode,
                        });
                    },
                    fail: (res) => {
                        console.log(res.authErrorScopes);
                    },
                });
            }
            function copyAuthCode() {
                navigator.clipboard.writeText(authcode);
            }
        </script>
    </body>
</html>
